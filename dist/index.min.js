var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,s){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):t.BetterScroller=s()}(this,function(){"use strict";function t(t,s,e,i){t.addEventListener?t.addEventListener(s,e,i):t.attachEvent&&t.attachEvent(["on",s].join(""),e)}function s(s,l){var a=this,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o=m.runwayItems||o,h=m.runwayItemsOpposite||h,n=m.scrollRunway||n,r=m.animationDurationMs||r,this.anchorItem={index:0,offset:0},this.firstAttachedItem_=0,this.lastAttachedItem_=0,this.anchorScrollTop=0,this.tombstoneSize_=0,this.tombstoneWidth_=0,this.tombstones_=[],this.scroller_=s,this.source_=l,this.items_=[],this.loadedItems_=0,this.requestInProgress_=!1,t(this.scroller_,"scroll",function(){i(a.onScroll_.bind(a))},!1),t(window,"resize",function(){e(a.onResize_.bind(a))},!1),this.scrollRunway_=document.createElement("div"),this.scrollRunway_.textContent=" ",this.scrollRunwayEnd_=0,this.scrollRunway_.style.position="absolute",this.scrollRunway_.style.height="1px",this.scrollRunway_.style.width="1px",this.scrollRunway_.style.contain="layout",this.scrollRunway_.style.transition="transform 0.2s",this.scroller_.appendChild(this.scrollRunway_),this.onResize_()}var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,s=void 0;return function(e){s&&clearTimeout(s),s=setTimeout(function(){s=null,e&&e()},t)}}(),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,s=void 0;return function(e){s||(s=setTimeout(function(){s=null,e&&e()},t))}}(),o=50,h=10,n=2e3,r=200;return s.prototype={onResize_:function(){var t=this.source_.createTombstone();t.style.position="absolute",this.scroller_.appendChild(t),t.classList.remove("invisible"),this.tombstoneSize_=t.offsetHeight,this.tombstoneWidth_=t.offsetWidth,this.scroller_.removeChild(t);for(var s=0;s<this.items_.length;s++)this.items_[s].height=this.items_[s].width=0;this.onScroll_()},onScroll_:function(){var t=this.scroller_.scrollTop-this.anchorScrollTop;0===this.scroller_.scrollTop?this.anchorItem={index:0,offset:0}:this.anchorItem=this.calculateAnchoredItem(this.anchorItem,t),this.anchorScrollTop=this.scroller_.scrollTop;var s=this.calculateAnchoredItem(this.anchorItem,this.scroller_.offsetHeight);t<0?this.fill(this.anchorItem.index-o,s.index+h):this.fill(this.anchorItem.index-h,s.index+o)},calculateAnchoredItem:function(t,s){if(0===s)return t;s+=t.offset;var e=t.index,i=0;if(s<0){for(;s<0&&e>0&&this.items_[e-1].height;)s+=this.items_[e-1].height,e--;i=Math.max(-e,Math.ceil(Math.min(s,0)/this.tombstoneSize_))}else{for(;s>0&&e<this.items_.length&&this.items_[e].height&&this.items_[e].height<s;)s-=this.items_[e].height,e++;(e>=this.items_.length||!this.items_[e].height)&&(i=Math.floor(Math.max(s,0)/this.tombstoneSize_))}return e+=i,s-=i*this.tombstoneSize_,{index:e,offset:s}},fill:function(t,s){this.firstAttachedItem_=Math.max(0,t),this.lastAttachedItem_=s,this.attachContent()},getTombstone:function(){var t=this.tombstones_.pop();return t?(t.classList.remove("invisible"),t.style.opacity=1,t.style.transform="",t.style.transition="",t):this.source_.createTombstone()},collectUnusedNodes_:function(){for(var t=[],s=0;s<this.items_.length;s++)s!==this.firstAttachedItem_?(this.items_[s].node&&(this.items_[s].node.classList.contains("tombstone")?(this.tombstones_.push(this.items_[s].node),this.tombstones_[this.tombstones_.length-1].classList.add("invisible")):t.push(this.items_[s].node)),this.items_[s].node=null):s=this.lastAttachedItem_-1;return t},attachContent:function(){var t=void 0,s=this.collectUnusedNodes_(),e={};for(t=this.firstAttachedItem_;t<this.lastAttachedItem_;t++){for(;this.items_.length<=t;)this.addItem_();if(this.items_[t].node){if(!this.items_[t].node.classList.contains("tombstone")||!this.items_[t].data)continue;r?(this.items_[t].node.style.zIndex=1,e[t]=[this.items_[t].node,this.items_[t].top-this.anchorScrollTop]):(this.items_[t].node.classList.add("invisible"),this.tombstones_.push(this.items_[t].node)),this.items_[t].node=null}var i=this.items_[t].data?this.source_.render(this.items_[t].data,s.pop()):this.getTombstone();i.style.position="absolute",this.items_[t].top=-1,this.scroller_.appendChild(i),this.items_[t].node=i}for(;s.length;)this.scroller_.removeChild(s.pop());for(t=this.firstAttachedItem_;t<this.lastAttachedItem_;t++)this.items_[t].data&&!this.items_[t].height&&(this.items_[t].height=this.items_[t].node.offsetHeight,this.items_[t].width=this.items_[t].node.offsetWidth);for(this.anchorScrollTop=0,t=0;t<this.anchorItem.index;t++)this.anchorScrollTop+=this.items_[t].height||this.tombstoneSize_;this.anchorScrollTop+=this.anchorItem.offset;var o=this.anchorScrollTop-this.anchorItem.offset;for(t=this.anchorItem.index;t>this.firstAttachedItem_;)o-=this.items_[t-1].height||this.tombstoneSize_,t--;for(;t<this.firstAttachedItem_;)o+=this.items_[t].height||this.tombstoneSize_,t++;for(var h in e){var l=e[h];this.items_[h].node.style.transform="translateY("+(this.anchorScrollTop+l[1])+"px) scale("+this.tombstoneWidth_/this.items_[h].width+", "+this.tombstoneSize_/this.items_[h].height+")",this.items_[h].node.offsetTop,l[0].offsetTop,this.items_[h].node.style.transition="transform "+r+"ms"}for(t=this.firstAttachedItem_;t<this.lastAttachedItem_;t++){var a=e[t];a&&(a[0].style.transition="transform "+r+"ms, opacity "+r+"ms",a[0].style.transform="translateY("+o+"px) scale("+this.items_[t].width/this.tombstoneWidth_+", "+this.items_[t].height/this.tombstoneSize_+")",a[0].style.opacity=0),o!==this.items_[t].top&&(a||(this.items_[t].node.style.transition=""),this.items_[t].node.style.transform="translateY("+o+"px)"),this.items_[t].top=o,o+=this.items_[t].height||this.tombstoneSize_}this.scrollRunwayEnd_=Math.max(this.scrollRunwayEnd_,o+n),this.scrollRunway_.style.transform="translate(0, "+this.scrollRunwayEnd_+"px)",this.scroller_.scrollTop=this.anchorScrollTop,r&&setTimeout(function(){for(var t in e){var s=e[t];s[0].classList.add("invisible"),this.tombstones_.push(s[0]),console.timeEnd("time replace")}}.bind(this),r),this.maybeRequestContent()},maybeRequestContent:function(){if(!this.requestInProgress_){var t=this.lastAttachedItem_-this.loadedItems_;t<=0||(this.requestInProgress_=!0,console.time("time replace"),this.source_.fetch(t,this.addContent.bind(this)))}},addItem_:function(){this.items_.push({data:null,node:null,height:0,width:0,top:0})},addContent:function(t){this.requestInProgress_=!1;for(var s=0;s<t.length;s++)this.items_.length<=this.loadedItems_&&this.addItem_(),this.items_[this.loadedItems_++].data=t[s];this.attachContent()}},s});